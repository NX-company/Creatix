# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –°—á–µ—Ç—á–∏–∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–π –Ω–µ —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ —Ä–µ–∂–∏–º–∞

## üêõ –ü—Ä–æ–±–ª–µ–º–∞

–ö–æ–≥–¥–∞ –ø–ª–∞—Ç–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ–∫–ª—é—á–∞–ª—Å—è –∏–∑ ADVANCED —Ä–µ–∂–∏–º–∞ –≤ FREE —Ä–µ–∂–∏–º –∏ —Å–æ–∑–¥–∞–≤–∞–ª –¥–æ–∫—É–º–µ–Ω—Ç, —Å—á–µ—Ç—á–∏–∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–π –æ—Å—Ç–∞–≤–∞–ª—Å—è –Ω–∞ 30/30 –∏ –Ω–µ —É–º–µ–Ω—å—à–∞–ª—Å—è.

**–ü—Ä–∏—á–∏–Ω–∞:**
- `ModeSelector` –º–µ–Ω—è–ª —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω—ã–π state (`Zustand`), –Ω–æ –ù–ï –æ–±–Ω–æ–≤–ª—è–ª `user.appMode` –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- API `/api/user/consume-generation` —á–∏—Ç–∞–ª `user.appMode` –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ –ø–æ–ª—É—á–∞–ª —Å—Ç–∞—Ä–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `ADVANCED`)
- –ü–æ—ç—Ç–æ–º—É —Å—á–µ—Ç—á–∏–∫ –æ–±–Ω–æ–≤–ª—è–ª—Å—è –≤ `advancedMonthlyGenerations`, –∞ –Ω–µ –≤ `freeMonthlyGenerations`

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. –°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π API endpoint: `/api/user/switch-mode`

**–§–∞–π–ª:** `app/api/user/switch-mode/route.ts`

–≠—Ç–æ—Ç endpoint:
- –ü—Ä–∏–Ω–∏–º–∞–µ—Ç `mode` (FREE, ADVANCED, PRO)
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–∞–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–ø–ª–∞—Ç–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è, –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ - —Ç–æ–ª—å–∫–æ FREE)
- –û–±–Ω–æ–≤–ª—è–µ—Ç `user.appMode` –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —É—Å–ø–µ—à–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

### 2. –û–±–Ω–æ–≤–ª–µ–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `ModeSelector`

**–§–∞–π–ª:** `components/ModeSelector.tsx`

–¢–µ–ø–µ—Ä—å –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ —Ä–µ–∂–∏–º–∞:
1. –í—ã–∑—ã–≤–∞–µ—Ç—Å—è API `/api/user/switch-mode` ‚Üí –æ–±–Ω–æ–≤–ª—è–µ—Ç –ë–î
2. –í—ã–∑—ã–≤–∞–µ—Ç—Å—è `updateSession()` ‚Üí –æ–±–Ω–æ–≤–ª—è–µ—Ç NextAuth session –∏–∑ –ë–î
3. –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω—ã–π state `setAppMode(mode)`
4. –¢—Ä–∏–≥–≥–µ—Ä–∏—Ç—Å—è —Å–æ–±—ã—Ç–∏–µ `mode-switched` ‚Üí –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—á–µ—Ç—á–∏–∫ –≤ Sidebar

---

## üîÑ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–µ–ø–µ—Ä—å

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "FREE" –≤ ModeSelector
         ‚Üì
API /api/user/switch-mode
  ‚Üí UPDATE users SET appMode = 'FREE' WHERE id = ...
         ‚Üì
updateSession()
  ‚Üí NextAuth –æ–±–Ω–æ–≤–ª—è–µ—Ç session –∏–∑ –ë–î
         ‚Üì
setAppMode('free')
  ‚Üí Zustand –æ–±–Ω–æ–≤–ª—è–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã–π state
         ‚Üì
Event 'mode-switched'
  ‚Üí Sidebar –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—á–µ—Ç—á–∏–∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–π
         ‚Üì
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç
         ‚Üì
API /api/user/consume-generation
  ‚Üí –ß–∏—Ç–∞–µ—Ç user.appMode = 'FREE' –∏–∑ –ë–î
  ‚Üí UPDATE users SET freeMonthlyGenerations = freeMonthlyGenerations + 1
         ‚Üì
–°—á–µ—Ç—á–∏–∫ —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è: 29/30 ‚úÖ
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. **–í–æ–π–¥–∏—Ç–µ –∫–∞–∫ –ø–ª–∞—Ç–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å** (—Å –∞–∫—Ç–∏–≤–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–æ–π ADVANCED)
2. **–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ—Å—å –≤ FREE —Ä–µ–∂–∏–º** —á–µ—Ä–µ–∑ ModeSelector
3. **–°–æ–∑–¥–∞–π—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç** (–ö–ü, –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—é, —Ä–µ–∑—é–º–µ)
4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—á–µ—Ç—á–∏–∫** –≤ –ª–µ–≤–æ–π –ø–∞–Ω–µ–ª–∏:
   - –î–æ–ª–∂–Ω–æ –±—ã—Ç—å `29/30` (–¥–ª—è FREE —Ä–µ–∂–∏–º–∞)
   - –ë–æ–Ω—É—Å–Ω—ã–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ù–ï –¥–æ–ª–∂–Ω—ã –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤ FREE —Ä–µ–∂–∏–º–µ
5. **–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ—Å—å –≤ ADVANCED —Ä–µ–∂–∏–º**
6. **–°–æ–∑–¥–∞–π—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç**
7. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—á–µ—Ç—á–∏–∫**:
   - –î–æ–ª–∂–Ω–æ –±—ã—Ç—å `99/100` (–∏–ª–∏ –º–µ–Ω—å—à–µ, –µ—Å–ª–∏ —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏)
   - –ë–æ–Ω—É—Å–Ω—ã–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è (–µ—Å–ª–∏ –µ—Å—Ç—å)

---

## üìã –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `app/api/user/switch-mode/route.ts` ‚Äî –Ω–æ–≤—ã–π API endpoint
- `components/ModeSelector.tsx` ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è –≤—ã–∑–æ–≤–∞ API
- `app/api/user/consume-generation/route.ts` ‚Äî —É–∂–µ –±—ã–ª –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ —Å —Ä–∞–∑–Ω—ã–º–∏ —Ä–µ–∂–∏–º–∞–º–∏
- `app/api/user/generations/route.ts` ‚Äî —É–∂–µ –±—ã–ª –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ —Å —Ä–∞–∑–Ω—ã–º–∏ —Å—á–µ—Ç—á–∏–∫–∞–º–∏

---

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç

–¢–µ–ø–µ—Ä—å —Å—á–µ—Ç—á–∏–∫–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–π —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ–∂–∏–º–∞:
- **FREE —Ä–µ–∂–∏–º** ‚Üí `freeMonthlyGenerations` (–ª–∏–º–∏—Ç: 30/–º–µ—Å—è—Ü)
- **ADVANCED —Ä–µ–∂–∏–º** ‚Üí `advancedMonthlyGenerations` (–ª–∏–º–∏—Ç: 100/–º–µ—Å—è—Ü + –±–æ–Ω—É—Å—ã)
- **PRO —Ä–µ–∂–∏–º** ‚Üí `monthlyGenerations` (–ª–∏–º–∏—Ç: 300/–º–µ—Å—è—Ü + –±–æ–Ω—É—Å—ã)

–ü–ª–∞—Ç–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç —Å–≤–æ–±–æ–¥–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è –º–µ–∂–¥—É —Ä–µ–∂–∏–º–∞–º–∏, –∏ –∫–∞–∂–¥—ã–π —Ä–µ–∂–∏–º –∏–º–µ–µ—Ç —Å–≤–æ–π –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–π —Å—á–µ—Ç—á–∏–∫.

