# –°–∏—Å—Ç–µ–º–∞ –ª–∏–º–∏—Ç–æ–≤ –≥–µ–Ω–µ—Ä–∞—Ü–∏–π

## üìä –û–±–∑–æ—Ä

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ–ª–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ª–∏–º–∏—Ç–∞–º–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–π —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π FREE, ADVANCED –∏ PRO —Ä–µ–∂–∏–º–æ–≤.

## üí∞ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞—Ä–∏—Ñ–æ–≤

### üÜì FREE —Ä–µ–∂–∏–º
- **30 –≥–µ–Ω–µ—Ä–∞—Ü–∏–π/–º–µ—Å—è—Ü** (–±–µ–∑ AI –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π)
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–æ–≤
- –ò—Å—Ç–æ—Ä–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ 1-–≥–æ —á–∏—Å–ª–∞ –∫–∞–∂–¥–æ–≥–æ –º–µ—Å—è—Ü–∞

### ‚ö° ADVANCED —Ä–µ–∂–∏–º
- **100 –≥–µ–Ω–µ—Ä–∞—Ü–∏–π/–º–µ—Å—è—Ü** —Å AI –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏
- –î–æ 10 Flux Schnell –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç
- –ü–∞—Ä—Å–∏–Ω–≥ —Å–∞–π—Ç–æ–≤
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
- **–°—Ç–æ–∏–º–æ—Å—Ç—å:** 1000‚ÇΩ/–º–µ—Å—è—Ü
- **–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–æ–∫—É–ø–∫–∏:** +30 –≥–µ–Ω–µ—Ä–∞—Ü–∏–π –∑–∞ 300‚ÇΩ

### üöÄ PRO —Ä–µ–∂–∏–º
- **300 –≥–µ–Ω–µ—Ä–∞—Ü–∏–π/–º–µ—Å—è—Ü** —Å AI –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏
- –î–æ 10 Flux Schnell –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç
- –í—Å–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ ADVANCED
- **–°—Ç–æ–∏–º–æ—Å—Ç—å:** 2500‚ÇΩ/–º–µ—Å—è—Ü

## üéØ –§–æ—Ä–º—É–ª–∞ —Ä–∞—Å—á–µ—Ç–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–π

```typescript
generationsNeeded = Math.ceil(imageCount / 10)
```

**–ü—Ä–∏–º–µ—Ä—ã:**
- 1-10 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π = 1 –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
- 11-20 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π = 2 –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- 21-30 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π = 3 –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- 35 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π = 4 –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

## üìÅ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### API Endpoints

#### `/api/user/generations` (GET)
–ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è—Ö —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**Response:**
```json
{
  "appMode": "ADVANCED",
  "monthlyGenerations": 15,
  "generationLimit": 100,
  "bonusGenerations": 30,
  "availableGenerations": 115,
  "nextResetDate": "2025-11-01T00:00:00.000Z",
  "subscriptionEndsAt": "2025-11-15T00:00:00.000Z"
}
```

#### `/api/user/consume-generation` (POST)
–°–ø–∏—Å–∞—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞.

**Request:**
```json
{
  "imageCount": 15
}
```

**Response:**
```json
{
  "success": true,
  "consumedGenerations": 2,
  "generationsFromMonthly": 2,
  "generationsFromBonus": 0,
  "remainingGenerations": 98,
  "costInfo": {
    "generationsNeeded": 2,
    "costInRubles": 20,
    "imagesPerGeneration": 8
  }
}
```

#### `/api/user/buy-generations` (POST)
–ö—É–ø–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (—Ç–æ–ª—å–∫–æ –¥–ª—è ADVANCED/PRO).

**Response:**
```json
{
  "success": true,
  "newBonusGenerations": 60,
  "addedGenerations": 30,
  "cost": 300
}
```

#### `/api/user/upgrade-mode` (POST)
–ê–ø–≥—Ä–µ–π–¥ –Ω–∞ ADVANCED –∏–ª–∏ PRO —Ä–µ–∂–∏–º.

**Request:**
```json
{
  "targetMode": "ADVANCED"
}
```

**Response:**
```json
{
  "success": true,
  "newMode": "ADVANCED",
  "newLimit": 100,
  "subscriptionEndsAt": "2025-11-15T00:00:00.000Z",
  "cost": 1000
}
```

#### `/api/cron/reset-generations` (POST)
–°–±—Ä–æ—Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–π –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (cron job).

**Headers:**
```
Authorization: Bearer {CRON_SECRET}
```

**Response:**
```json
{
  "success": true,
  "resetCount": 42,
  "message": "Reset generations for 42 users"
}
```

### UI Components

#### `GenerationLimitModal`
–ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ª–∏–º–∏—Ç–∞—Ö:
- –î–ª—è –≥–æ—Å—Ç–µ–π: –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- –î–ª—è FREE: –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –∞–ø–≥—Ä–µ–π–¥–∞
- –î–ª—è ADVANCED/PRO: –∫–Ω–æ–ø–∫–∞ –ø–æ–∫—É–ø–∫–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –≥–µ–Ω–µ—Ä–∞—Ü–∏–π

#### `BuyGenerationsModal`
–ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–∫—É–ø–∫–∏ –ø–∞–∫–µ—Ç–∞ +30 –≥–µ–Ω–µ—Ä–∞—Ü–∏–π –∑–∞ 300‚ÇΩ.

#### `WelcomeUpgradeModal`
–ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–∞ Welcome page –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å –≤—ã–±–æ—Ä–æ–º –ø–ª–∞–Ω–∞.

#### Sidebar - –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –≥–µ–Ω–µ—Ä–∞—Ü–∏–π
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
- –¢–µ–∫—É—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≥–µ–Ω–µ—Ä–∞—Ü–∏–π
- –õ–∏–º–∏—Ç –Ω–∞ –º–µ—Å—è—Ü
- –ë–æ–Ω—É—Å–Ω—ã–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å)
- –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä
- –î–∞—Ç—É —Å–ª–µ–¥—É—é—â–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- –ö–Ω–æ–ø–∫—É –ø–æ–∫—É–ø–∫–∏ (–¥–ª—è ADVANCED/PRO)

### Database Schema

```prisma
model User {
  monthlyGenerations  Int       @default(0)      // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ –≤ —Ç–µ–∫—É—â–µ–º –º–µ—Å—è—Ü–µ
  generationLimit     Int       @default(30)     // –õ–∏–º–∏—Ç –Ω–∞ –º–µ—Å—è—Ü
  bonusGenerations    Int       @default(0)      // –ö—É–ø–ª–µ–Ω–Ω—ã–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ
  lastResetDate       DateTime?                   // –î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–±—Ä–æ—Å–∞
  subscriptionEndsAt  DateTime?                   // –î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏
}
```

## üîÑ –ê–≤—Ç–æ—Å–±—Ä–æ—Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–π

–ù–∞—Å—Ç—Ä–æ–µ–Ω Vercel Cron Job:
- **–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ:** 0 0 1 * * (–∫–∞–∂–¥–æ–µ 1-–µ —á–∏—Å–ª–æ –º–µ—Å—è—Ü–∞ –≤ 00:00 UTC)
- **Endpoint:** `/api/cron/reset-generations`
- **–î–µ–π—Å—Ç–≤–∏–µ:** –°–±—Ä–æ—Å `monthlyGenerations` –∏ `bonusGenerations` –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ `/api/user/generations`.

## üîí –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤ –≤ ChatPanel

1. **–ü–µ—Ä–µ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π:**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≥–µ–Ω–µ—Ä–∞—Ü–∏–π
   - –†–∞—Å—á–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ —Ñ–æ—Ä–º—É–ª–µ
   - –ü–æ–∫–∞–∑ –º–æ–¥–∞–ª–∫–∏ –µ—Å–ª–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ

2. **–ü–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:**
   - –°–ø–∏—Å–∞–Ω–∏–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–π —á–µ—Ä–µ–∑ API
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
   - –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –µ—Å–ª–∏ –æ—Å—Ç–∞–ª–æ—Å—å ‚â§5 –≥–µ–Ω–µ—Ä–∞—Ü–∏–π

## üé® User Flow

### –ì–æ—Å—Ç—å –Ω–∞ Welcome Page
1. –í–≤–æ–¥–∏—Ç –ø—Ä–æ–º—Ç
2. –ü–æ–ª—É—á–∞–µ—Ç **1 –±–µ—Å–ø–ª–∞—Ç–Ω—É—é ADVANCED –≥–µ–Ω–µ—Ä–∞—Ü–∏—é** —Å AI –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏
3. –í–∏–¥–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç
4. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –º–æ–¥–∞–ª–∫–∞ —Å –≤—ã–±–æ—Ä–æ–º –ø–ª–∞–Ω–∞:
   - **FREE:** –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è ‚Üí 30 –≥–µ–Ω–µ—Ä–∞—Ü–∏–π/–º–µ—Å
   - **ADVANCED:** –û–ø–ª–∞—Ç–∞ 1000‚ÇΩ ‚Üí 100 –≥–µ–Ω–µ—Ä–∞—Ü–∏–π/–º–µ—Å

### –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (FREE)
1. –°–æ–∑–¥–∞–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç—ã (30/–º–µ—Å—è—Ü –±–µ–∑ AI –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π)
2. –ü—Ä–∏ –æ—Å—Ç–∞—Ç–∫–µ ‚â§5: –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –∞–ø–≥—Ä–µ–π–¥–∞
3. –ü—Ä–∏ 0: –º–æ–¥–∞–ª–∫–∞ —Å –∞–ø–≥—Ä–µ–π–¥–æ–º –Ω–∞ ADVANCED

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ADVANCED
1. –°–æ–∑–¥–∞–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç—ã —Å AI –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏
2. –ü—Ä–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–µ: –∫–Ω–æ–ø–∫–∞ "–ö—É–ø–∏—Ç—å +30 –∑–∞ 300‚ÇΩ"
3. –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ 1-–≥–æ —á–∏—Å–ª–∞ –º–µ—Å—è—Ü–∞

## üí∏ –≠–∫–æ–Ω–æ–º–∏–∫–∞

### ADVANCED (1000‚ÇΩ/–º–µ—Å, 100 –≥–µ–Ω–µ—Ä–∞—Ü–∏–π)

**–ó–∞—Ç—Ä–∞—Ç—ã:**
- –¢–µ–∫—Å—Ç (Gemini 2.0 Flash): $0.001/–¥–æ–∫—É–º–µ–Ω—Ç
- AI –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (10 √ó Flux Schnell): $0.03/–¥–æ–∫—É–º–µ–Ω—Ç
- **–ò—Ç–æ–≥–æ:** $0.031/–¥–æ–∫—É–º–µ–Ω—Ç
- **100 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤:** $3.10

**–ü—Ä–∏–±—ã–ª—å:**
- –î–æ—Ö–æ–¥: $10.50 (1000‚ÇΩ)
- –ó–∞—Ç—Ä–∞—Ç—ã: $3.10
- **–ü—Ä–∏–±—ã–ª—å: $7.40 (70% –º–∞—Ä–∂–∞)** ‚úÖ

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –ø–∞–∫–µ—Ç (300‚ÇΩ, 30 –≥–µ–Ω–µ—Ä–∞—Ü–∏–π)

**–ó–∞—Ç—Ä–∞—Ç—ã:**
- **30 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤:** $0.93

**–ü—Ä–∏–±—ã–ª—å:**
- –î–æ—Ö–æ–¥: $3.15 (300‚ÇΩ)
- –ó–∞—Ç—Ä–∞—Ç—ã: $0.93
- **–ü—Ä–∏–±—ã–ª—å: $2.22 (70% –º–∞—Ä–∂–∞)** ‚úÖ

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### Environment Variables

```env
# –í .env.local –∏–ª–∏ Vercel
CRON_SECRET=your-secure-random-string
```

### Vercel Deployment

```json
// vercel.json
{
  "crons": [
    {
      "path": "/api/cron/reset-generations",
      "schedule": "0 0 1 * *"
    }
  ]
}
```

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### Client-side –ø—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤

```typescript
import { checkGenerationAvailability, consumeGeneration } from '@/lib/consumeGeneration'

// –ü–µ—Ä–µ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π
const availability = await checkGenerationAvailability(imageCount)
if (!availability.canGenerate) {
  // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª–∫—É
  return
}

// –ü–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
const result = await consumeGeneration(imageCount)
console.log(`–°–ø–∏—Å–∞–Ω–æ ${result.consumedGenerations} –≥–µ–Ω–µ—Ä–∞—Ü–∏–π`)
```

### Server-side –ø–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏

```typescript
import { prisma } from '@/lib/db'
import { shouldResetGenerations } from '@/lib/generationLimits'

const user = await prisma.user.findUnique({ where: { email } })

if (user.lastResetDate && shouldResetGenerations(user.lastResetDate)) {
  await prisma.user.update({
    where: { id: user.id },
    data: {
      monthlyGenerations: 0,
      bonusGenerations: 0,
      lastResetDate: new Date(),
    },
  })
}
```

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

- ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (Prisma schema + migration)
- ‚úÖ API endpoints (4 —à—Ç)
- ‚úÖ –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ (3 —à—Ç)
- ‚úÖ –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –≥–µ–Ω–µ—Ä–∞—Ü–∏–π –≤ Sidebar
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤ –≤ ChatPanel
- ‚úÖ –°–ø–∏—Å–∞–Ω–∏–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–π –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è
- ‚úÖ –ê–≤—Ç–æ—Å–±—Ä–æ—Å 1-–≥–æ —á–∏—Å–ª–∞ –º–µ—Å—è—Ü–∞ (Vercel Cron)
- ‚úÖ –§–æ—Ä–º—É–ª–∞ —Ä–∞—Å—á–µ—Ç–∞ (Math.ceil(imageCount/10))
- ‚úÖ –ü–æ–∫—É–ø–∫–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–∞–∫–æ–≤
- ‚úÖ –ê–ø–≥—Ä–µ–π–¥ —Ä–µ–∂–∏–º–æ–≤

## üéØ –ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é!

