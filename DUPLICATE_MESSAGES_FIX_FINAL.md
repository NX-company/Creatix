# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π - –§–ò–ù–ê–õ–¨–ù–û–ï –†–ï–®–ï–ù–ò–ï

## üêõ –ü—Ä–æ–±–ª–µ–º–∞
–í –≥–æ—Å—Ç–µ–≤–æ–º —Ä–µ–∂–∏–º–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥—É–±–ª–∏—Ä–æ–≤–∞–ª–∏—Å—å –≤ —á–∞—Ç–µ:
```
üé® –†–∏—Å—É—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ 1/3: "A dynamic, modern office..."
üé® –†–∏—Å—É—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ 2/3: "An infographic-style..."
üé® –†–∏—Å—É—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ 1/3: "A modern, clean hero..."  ‚Üê –î–£–ë–õ–ò–ö–ê–¢!
üé® –†–∏—Å—É—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ 3/3: "Abstract digital..."
üé® –†–∏—Å—É—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ 2/3: "An infographic-style..."  ‚Üê –î–£–ë–õ–ò–ö–ê–¢!
```

## üîç –ü—Ä–∏—á–∏–Ω–∞

### –ü–µ—Ä–≤–æ–ø—Ä–∏—á–∏–Ω–∞: React StrictMode
React 18+ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ **–Ω–∞–º–µ—Ä–µ–Ω–Ω–æ** –≤—ã–∑—ã–≤–∞–µ—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏ —ç—Ñ—Ñ–µ–∫—Ç—ã –¥–≤–∞–∂–¥—ã –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è –ø–æ–±–æ—á–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤.

### –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã:

1. **–î–≤–æ–π–Ω–æ–π –≤—ã–∑–æ–≤ useEffect** (page.tsx):
   ```typescript
   useEffect(() => {
     // –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –î–í–ê–ñ–î–´ –≤ StrictMode
     window.dispatchEvent('trigger-auto-generation', { prompt })
   }, [])
   ```

2. **–î–≤–æ–π–Ω–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è** (ChatPanel.tsx):
   ```typescript
   useEffect(() => {
     window.addEventListener('trigger-auto-generation', handleAutoGeneration)
     // –°–ª—É—à–∞—Ç–µ–ª—å —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è –î–í–ê–ñ–î–´ –∏–∑-–∑–∞ —Ä–µ-—Ä–µ–Ω–¥–µ—Ä–∞
   }, [])
   ```

3. **–î–≤–æ–π–Ω–æ–π –≤—ã–∑–æ–≤ handleRun**:
   - –ü–µ—Ä–≤—ã–π –≤—ã–∑–æ–≤: `isGeneratingRef.current = false` ‚Üí –Ω–∞—á–∏–Ω–∞–µ—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏—é
   - –í—Ç–æ—Ä–æ–π –≤—ã–∑–æ–≤ (0.1ms –ø–æ–∑–∂–µ): `isGeneratingRef.current` –µ—â–µ `false` ‚Üí –∑–∞–ø—É—Å–∫–∞–µ—Ç –≤—Ç–æ—Ä—É—é –≥–µ–Ω–µ—Ä–∞—Ü–∏—é!

4. **–î–≤–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏**:
   - –ö–∞–∂–¥–∞—è —Å–æ–∑–¥–∞–µ—Ç —Å–≤–æ–∏ 3 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
   - –í—Å–µ–≥–æ 6 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
   - –°–æ–æ–±—â–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ—à–∏–≤–∞—é—Ç—Å—è –≤ —á–∞—Ç–µ

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. useRef –≤–º–µ—Å—Ç–æ –ª–æ–∫–∞–ª—å–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π

**–ë—ã–ª–æ (–ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç):**
```typescript
useEffect(() => {
  let hasTriggered = false // –°–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–Ω–æ–≤–æ –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Ä–µ-—Ä–µ–Ω–¥–µ—Ä–µ!
  
  const handleAutoGeneration = (event) => {
    if (hasTriggered) return
    hasTriggered = true
    // ...
  }
}, [])
```

**–°—Ç–∞–ª–æ (—Ä–∞–±–æ—Ç–∞–µ—Ç):**
```typescript
const hasTriggeredAutoGen = useRef(false) // –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –º–µ–∂–¥—É —Ä–µ-—Ä–µ–Ω–¥–µ—Ä–∞–º–∏

useEffect(() => {
  const handleAutoGeneration = (event) => {
    if (hasTriggeredAutoGen.current) return // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç!
    hasTriggeredAutoGen.current = true
    // ...
  }
}, [])
```

### 2. –†–∞–Ω–Ω—è—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ñ–ª–∞–≥–∞ –≤ handleRun

**–ë—ã–ª–æ (race condition):**
```typescript
const handleRun = async () => {
  if (isGeneratingRef.current) return
  
  // –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏...
  await checkLimits()
  
  isGeneratingRef.current = true // ‚ùå –°–ª–∏—à–∫–æ–º –ø–æ–∑–¥–Ω–æ!
}
```

**–°—Ç–∞–ª–æ (–±–µ–∑–æ–ø–∞—Å–Ω–æ):**
```typescript
const handleRun = async () => {
  if (loading || !input.trim()) return
  
  // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ñ–ª–∞–≥–∞ –°–†–ê–ó–£ –ø–æ—Å–ª–µ –±–∞–∑–æ–≤—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫
  if (isGeneratingRef.current) return
  isGeneratingRef.current = true // ‚úÖ –ë–ª–æ–∫–∏—Ä—É–µ—Ç –≤—Ç–æ—Ä–æ–π –≤—ã–∑–æ–≤!
  
  // –û—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞...
}
```

### 3. Set –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π

```typescript
const shownProgressMessages = useRef<Set<string>>(new Set())

const onProgress = (msg: string) => {
  if (shownProgressMessages.current.has(msg)) {
    console.log('‚è≠Ô∏è Skipping duplicate progress:', msg)
    return
  }
  shownProgressMessages.current.add(msg)
  // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç
}
```

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- ‚ùå –î–≤–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- ‚ùå 6 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤–º–µ—Å—Ç–æ 3
- ‚ùå –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç–µ
- ‚ùå –ù–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–π –ø–æ—Ä—è–¥–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- ‚úÖ –û–¥–Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
- ‚úÖ 3 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
- ‚úÖ –ö–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–¥–∏–Ω —Ä–∞–∑
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π

## üß™ –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å

1. –û—á–∏—Å—Ç–∏—Ç–µ –∫—ç—à:
   ```javascript
   localStorage.clear()
   sessionStorage.clear()
   location.reload()
   ```

2. –û—Ç–∫—Ä–æ–π—Ç–µ `/welcome` –∏ —Å–æ–∑–¥–∞–π—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç

3. –°–ª–µ–¥–∏—Ç–µ –∑–∞ –∫–æ–Ω—Å–æ–ª—å—é (F12):
   ```
   ‚úÖ Progress: üé® –†–∏—Å—É—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ 1/3...
   ‚úÖ Progress: üé® –†–∏—Å—É—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ 2/3...
   ‚úÖ Progress: üé® –†–∏—Å—É—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ 3/3...
   ```

   –ï—Å–ª–∏ –µ—Å—Ç—å –¥—É–±–ª–∏–∫–∞—Ç—ã, —É–≤–∏–¥–∏—Ç–µ:
   ```
   ‚è≠Ô∏è Skipping duplicate progress: üé® –†–∏—Å—É—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ...
   ```

## üîß –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `components/ChatPanel.tsx`:
  - –î–æ–±–∞–≤–ª–µ–Ω `hasTriggeredAutoGen = useRef(false)`
  - –ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω–∞ –ª–æ–≥–∏–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –≤ `handleRun`
  - Set –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å-—Å–æ–æ–±—â–µ–Ω–∏–π

## üìù –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ

### –ü–æ—á–µ–º—É useRef –∫—Ä–∏—Ç–∏—á–µ–Ω –∑–¥–µ—Å—å?

```typescript
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: –õ–æ–∫–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è
useEffect(() => {
  let flag = false // –ö–∞–∂–¥—ã–π —Ä–µ-—Ä–µ–Ω–¥–µ—Ä —Å–æ–∑–¥–∞–µ—Ç –ù–û–í–£–Æ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
  // ...
}, [])

// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: useRef
const flag = useRef(false) // –û–¥–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –Ω–∞ –≤–µ—Å—å –∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
useEffect(() => {
  if (flag.current) return
  flag.current = true
}, [])
```

### –ü–æ—á–µ–º—É race condition –≤ async —Ñ—É–Ω–∫—Ü–∏—è—Ö?

```typescript
// ‚ùå –ü—Ä–æ–±–ª–µ–º–∞:
const func = async () => {
  if (flag) return
  await asyncOperation() // –í—Ç–æ—Ä–æ–π –≤—ã–∑–æ–≤ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –∑–¥–µ—Å—å!
  flag = true // –°–ª–∏—à–∫–æ–º –ø–æ–∑–¥–Ω–æ
}

// ‚úÖ –†–µ—à–µ–Ω–∏–µ:
const func = async () => {
  if (flag) return
  flag = true // –£—Å—Ç–∞–Ω–æ–≤–∏–ª–∏ —Å—Ä–∞–∑—É
  await asyncOperation() // –¢–µ–ø–µ—Ä—å –±–µ–∑–æ–ø–∞—Å–Ω–æ
}
```

## üéØ –°—Ç–∞—Ç—É—Å
‚úÖ **–ü–û–õ–ù–û–°–¢–¨–Æ –ò–°–ü–†–ê–í–õ–ï–ù–û**

## üìÖ –î–∞—Ç–∞
16 –æ–∫—Ç—è–±—Ä—è 2025
