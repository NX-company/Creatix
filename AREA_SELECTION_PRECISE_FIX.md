# –¢–æ—á–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏ - –£–ª—É—á—à–µ–Ω–∏–µ

## –ü—Ä–æ–±–ª–µ–º–∞
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±—Ä–∞–ª –æ–±–ª–∞—Å—Ç—å `div:nth-child(1)` –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ–≥—É—Ä—Ü–∞, –Ω–æ AI –≤—Å—Ç–∞–≤–∏–ª –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –¥—Ä—É–≥–æ–º –º–µ—Å—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞. –°–µ–ª–µ–∫—Ç–æ—Ä –±—ã–ª —Å–ª–∏—à–∫–æ–º –æ–±—â–∏–º –∏ –Ω–µ –¥–∞–≤–∞–ª AI –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.

### –ü—Ä–∏—á–∏–Ω—ã:
1. **–°–ª–∏—à–∫–æ–º –ø—Ä–æ—Å—Ç–æ–π —Å–µ–ª–µ–∫—Ç–æ—Ä** - `div:nth-child(1)` –º–æ–∂–µ—Ç –Ω–∞–π—Ç–∏ –ø–µ—Ä–≤—ã–π div –≤ –ª—é–±–æ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
2. **–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è AI** - –ø–µ—Ä–µ–¥–∞–≤–∞–ª—Å—è —Ç–æ–ª—å–∫–æ `innerHTML` (2 —Å–∏–º–≤–æ–ª–∞: "‚öôÔ∏è") –±–µ–∑ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ä–æ–¥–∏—Ç–µ–ª–µ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ
3. **–ù–µ—Ç–æ—á–Ω–∞—è –∑–∞–º–µ–Ω–∞ —ç–ª–µ–º–µ–Ω—Ç–∞** - –±–µ–∑ —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ —Å–µ–ª–µ–∫—Ç–æ—Ä–∞ –∑–∞–º–µ–Ω–∞ –º–æ–≥–ª–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å –≤ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –º–µ—Å—Ç–µ

## –†–µ—à–µ–Ω–∏–µ

### 1. –£–ª—É—á—à–µ–Ω–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤ (`components/PreviewFrame.tsx:36-64`)

–°–æ–∑–¥–∞–µ–º –±–æ–ª–µ–µ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã —Å —É—á–µ—Ç–æ–º:
- ID —ç–ª–µ–º–µ–Ω—Ç–∞ (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
- –ö–ª–∞—Å—Å–æ–≤ —ç–ª–µ–º–µ–Ω—Ç–∞
- –†–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (ID –∏–ª–∏ –∫–ª–∞—Å—Å—ã —Ä–æ–¥–∏—Ç–µ–ª—è)
- –ü–æ–∑–∏—Ü–∏–∏ —Å—Ä–µ–¥–∏ —Å–æ—Å–µ–¥–µ–π

```typescript
const getElementSelector = (element: HTMLElement): string => {
  // 1. –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: ID
  if (element.id) return `#${element.id}`
  
  const tag = element.tagName.toLowerCase()
  
  // 2. –ö–ª–∞—Å—Å + nth-child –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏
  const classes = element.className ? `.${element.className.split(' ').filter(c => c).join('.')}` : ''
  
  // 3. –ü–æ–ª—É—á–∞–µ–º –ø—É—Ç—å –æ—Ç —Ä–æ–¥–∏—Ç–µ–ª—è –¥–ª—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏
  const parent = element.parentElement
  if (!parent) return tag + classes
  
  const siblings = Array.from(parent.children)
  const index = siblings.indexOf(element)
  
  // 4. –†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏
  let parentSelector = ''
  if (parent.id) {
    parentSelector = `#${parent.id} > `
  } else if (parent.className) {
    const parentClasses = parent.className.split(' ').filter(c => c).join('.')
    parentSelector = `.${parentClasses} > `
  }
  
  // 5. –§–∏–Ω–∞–ª—å–Ω—ã–π —Å–µ–ª–µ–∫—Ç–æ—Ä: —Ä–æ–¥–∏—Ç–µ–ª—å > —ç–ª–µ–º–µ–Ω—Ç.–∫–ª–∞—Å—Å:nth-child(N)
  return `${parentSelector}${tag}${classes}:nth-child(${index + 1})`
}
```

**–ü—Ä–∏–º–µ—Ä—ã —É–ª—É—á—à–µ–Ω–Ω—ã—Ö —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤:**
- –ë—ã–ª–æ: `div:nth-child(1)` 
- –°—Ç–∞–ª–æ: `.container.main > div.content:nth-child(1)`
- –ò–ª–∏: `#header > nav.menu:nth-child(2)`

### 2. –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç —ç–ª–µ–º–µ–Ω—Ç–∞ (`components/PreviewFrame.tsx:95-106`)

–ü—Ä–∏ –≤—ã–±–æ—Ä–µ —ç–ª–µ–º–µ–Ω—Ç–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é:

```typescript
setSelectedElement({
  selector,                  // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π —Å–µ–ª–µ–∫—Ç–æ—Ä
  innerHTML: target.innerHTML,  // –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç–ª–µ–º–µ–Ω—Ç–∞
  outerHTML: target.outerHTML,  // –ü–æ–ª–Ω—ã–π HTML —Å —Ç–µ–≥–∞–º–∏
  textContent: truncatedText,   // –¢–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
  parentSelector: parent ? getElementSelector(parent) : undefined,  // –°–µ–ª–µ–∫—Ç–æ—Ä —Ä–æ–¥–∏—Ç–µ–ª—è
  parentContext: parentContext  // –ö–æ–Ω—Ç–µ–∫—Å—Ç —Ä–æ–¥–∏—Ç–µ–ª—è
})
```

### 3. –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Ç–∏–ø –≤ Store (`lib/store.ts:217-225`)

```typescript
selectedElement: {
  selector: string          // –û—Å–Ω–æ–≤–Ω–æ–π —Å–µ–ª–µ–∫—Ç–æ—Ä
  innerHTML: string         // –í–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
  outerHTML?: string       // –ü–æ–ª–Ω—ã–π HTML —ç–ª–µ–º–µ–Ω—Ç–∞
  textContent: string       // –¢–µ–∫—Å—Ç
  parentSelector?: string   // –°–µ–ª–µ–∫—Ç–æ—Ä —Ä–æ–¥–∏—Ç–µ–ª—è
  parentContext?: string    // –ö–æ–Ω—Ç–µ–∫—Å—Ç —Ä–æ–¥–∏—Ç–µ–ª—è
} | null
```

### 4. –£–ª—É—á—à–µ–Ω–Ω—ã–π AI Editor (`lib/aiEditor.ts:18-33`)

–¢–µ–ø–µ—Ä—å AI –ø–æ–ª—É—á–∞–µ—Ç:
- –ü–æ–ª–Ω—ã–π `outerHTML` —ç–ª–µ–º–µ–Ω—Ç–∞ (—Å —Ç–µ–≥–∞–º–∏)
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ
- –¢–æ—á–Ω—ã–π —Å–µ–ª–µ–∫—Ç–æ—Ä –¥–ª—è –∑–∞–º–µ–Ω—ã

```typescript
if (selectedElement) {
  // –ò—Å–ø–æ–ª—å–∑—É–µ–º outerHTML –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —ç–ª–µ–º–µ–Ω—Ç–∞
  const elementHTML = selectedElement.outerHTML || selectedElement.innerHTML || selectedElement.textContent || '<div></div>'
  
  // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç —Ä–æ–¥–∏—Ç–µ–ª—è –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏
  if (selectedElement.parentContext && selectedElement.parentSelector) {
    elementContext = `\nüè† –†–û–î–ò–¢–ï–õ–¨–°–ö–ò–ô –ö–û–ù–¢–ï–ö–°–¢:\n–≠–ª–µ–º–µ–Ω—Ç –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤–Ω—É—Ç—Ä–∏: ${selectedElement.parentContext}\n–°–µ–ª–µ–∫—Ç–æ—Ä —Ä–æ–¥–∏—Ç–µ–ª—è: ${selectedElement.parentSelector}\n`
  }
  
  contextForAI = elementHTML
  isContextualEdit = true
}
```

### 5. –£–ª—É—á—à–µ–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è AI (`lib/aiEditor.ts:51-92`)

–î–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ç–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:

```
‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û –î–õ–Ø –ö–û–ù–¢–ï–ö–°–¢–ù–û–ì–û –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–Ø:
- –ó–ê–ú–ï–ù–ò –í–ï–°–¨ –≠–õ–ï–ú–ï–ù–¢ –ø–æ–ª–Ω–æ—Å—Ç—å—é, –≤–∫–ª—é—á–∞—è –µ–≥–æ –æ—Ç–∫—Ä—ã–≤–∞—é—â–∏–π –∏ –∑–∞–∫—Ä—ã–≤–∞—é—â–∏–π —Ç–µ–≥–∏
- –°–æ—Ö—Ä–∞–Ω–∏ —Ç–∏–ø —ç–ª–µ–º–µ–Ω—Ç–∞ (div, section, etc.) –∏–ª–∏ –∏–∑–º–µ–Ω–∏ –Ω–∞ –ø–æ–¥—Ö–æ–¥—è—â–∏–π
- –£–¥–∞–ª–∏ —Å—Ç–∞—Ä–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∏ –≤—Å—Ç–∞–≤—å –Ω–æ–≤–æ–µ –í–ù–£–¢–†–¨ —ç–ª–µ–º–µ–Ω—Ç–∞
- –ù–ï –¥–æ–±–∞–≤–ª—è–π —ç–ª–µ–º–µ–Ω—Ç —Ä—è–¥–æ–º - –ó–ê–ú–ï–ù–ò –µ–≥–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ!

–§–û–†–ú–ê–¢ –û–¢–í–ï–¢–ê:
–í–µ—Ä–Ω–∏ –¢–û–õ–¨–ö–û –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç —Å –æ—Ç–∫—Ä—ã–≤–∞—é—â–∏–º –∏ –∑–∞–∫—Ä—ã–≤–∞—é—â–∏–º —Ç–µ–≥–∞–º–∏.
–ü—Ä–∏–º–µ—Ä: <div style="...">–ù–û–í–û–ï –°–û–î–ï–†–ñ–ò–ú–û–ï –° IMAGE_PLACEHOLDER</div>
–ë–ï–ó –æ–±–µ—Ä—Ç–∫–∏ html/body, –ë–ï–ó –æ–±—ä—è—Å–Ω–µ–Ω–∏–π, –ë–ï–ó markdown.
```

## –†–µ–∑—É–ª—å—Ç–∞—Ç

‚úÖ **–£–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã** - –∫–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç –∏–º–µ–µ—Ç —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–π —Å–µ–ª–µ–∫—Ç–æ—Ä —Å —É—á–µ—Ç–æ–º —Ä–æ–¥–∏—Ç–µ–ª—è –∏ –∫–ª–∞—Å—Å–æ–≤

‚úÖ **–ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è AI** - AI –≤–∏–¥–∏—Ç –ø–æ–ª–Ω—ã–π HTML —ç–ª–µ–º–µ–Ω—Ç–∞ –∏ –µ–≥–æ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ

‚úÖ **–¢–æ—á–Ω–∞—è –∑–∞–º–µ–Ω–∞** - –∑–∞–º–µ–Ω–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∏–º–µ–Ω–Ω–æ –≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–º —ç–ª–µ–º–µ–Ω—Ç–µ, –Ω–µ –≤ –¥—Ä—É–≥–∏—Ö —á–∞—Å—Ç—è—Ö –¥–æ–∫—É–º–µ–Ω—Ç–∞

‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π** - "—Å—é–¥–∞/—Ç—É—Ç/–≤ —ç—Ç—É –æ–±–ª–∞—Å—Ç—å" —Ç–µ–ø–µ—Ä—å —Ç–æ—á–Ω–æ –æ–∑–Ω–∞—á–∞–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. –í—ã–±–µ—Ä–∏—Ç–µ —ç–ª–µ–º–µ–Ω—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—É—Å—Ç–æ–π div —Å –∏–∫–æ–Ω–∫–æ–π ‚öôÔ∏è)
2. –ö–Ω–æ–ø–∫–∞ —Å—Ç–∞–Ω–µ—Ç –∑–µ–ª–µ–Ω–æ–π, –≤ –∫–æ–Ω—Å–æ–ª–∏ –ø–æ—è–≤–∏—Ç—Å—è: `üéØ –†–µ–∂–∏–º –≤—ã–±–æ—Ä–∞ –æ–±–ª–∞—Å—Ç–∏ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω`
3. –í–≤–µ–¥–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É: "—Å–¥–µ–ª–∞–π —Ç—É—Ç –æ–≥—É—Ä–µ—Ü" –∏–ª–∏ "–≤—Å—Ç–∞–≤—å —Å—é–¥–∞ —Ñ–æ—Ç–æ –∫–æ—Ç–∞"
4. AI –∑–∞–º–µ–Ω–∏—Ç –¢–û–õ–¨–ö–û –≤—ã–±—Ä–∞–Ω–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç, –≤—Å—Ç–∞–≤–∏–≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –í–ù–£–¢–†–¨ –Ω–µ–≥–æ
5. –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ—è–≤–∏—Ç—Å—è —Ç–æ—á–Ω–æ —Ç–∞–º, –≥–¥–µ –≤—ã –≤—ã–±—Ä–∞–ª–∏

## –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã
- `components/PreviewFrame.tsx` - —É–ª—É—á—à–µ–Ω–Ω—ã–π `getElementSelector`, —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç —ç–ª–µ–º–µ–Ω—Ç–∞
- `lib/store.ts` - –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Ç–∏–ø `SelectedElement` —Å –Ω–æ–≤—ã–º–∏ –ø–æ–ª—è–º–∏
- `lib/aiEditor.ts` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `outerHTML` –∏ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞, —É–ª—É—á—à–µ–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç
- `AREA_SELECTION_PRECISE_FIX.md` - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

