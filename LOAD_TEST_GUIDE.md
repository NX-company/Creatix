# üß™ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–º—É —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ dev —Å–µ—Ä–≤–µ—Ä
```bash
npm run dev
```

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ health check
```bash
curl http://localhost:3000/api/system/health
```

–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:
```json
{
  "status": "healthy",
  "overall": {
    "healthy": true,
    "totalCapacity": 83
  }
}
```

### 3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç (10 –∑–∞–ø—Ä–æ—Å–æ–≤)
```bash
curl -X POST http://localhost:3000/api/test/load \
  -H "Content-Type: application/json" \
  -d '{"requests": 10, "delay": 100}'
```

## –¢–∏–ø—ã —Ç–µ—Å—Ç–æ–≤

### –¢–µ—Å—Ç 1: –ù–µ–±–æ–ª—å—à–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ (10 –∑–∞–ø—Ä–æ—Å–æ–≤)
```bash
curl -X POST http://localhost:3000/api/test/load \
  -H "Content-Type: application/json" \
  -d '{"requests": 10, "delay": 100}'
```

**–û–∂–∏–¥–∞–µ–º–æ–µ –≤—Ä–µ–º—è:** 5-10 —Å–µ–∫—É–Ω–¥  
**–¶–µ–ª—å:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

### –¢–µ—Å—Ç 2: –°—Ä–µ–¥–Ω—è—è –Ω–∞–≥—Ä—É–∑–∫–∞ (30 –∑–∞–ø—Ä–æ—Å–æ–≤)
```bash
curl -X POST http://localhost:3000/api/test/load \
  -H "Content-Type: application/json" \
  -d '{"requests": 30, "delay": 50}'
```

**–û–∂–∏–¥–∞–µ–º–æ–µ –≤—Ä–µ–º—è:** 15-25 —Å–µ–∫—É–Ω–¥  
**–¶–µ–ª—å:** –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã –æ—á–µ—Ä–µ–¥–∏

### –¢–µ—Å—Ç 3: –í—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ (50 –∑–∞–ø—Ä–æ—Å–æ–≤)
```bash
curl -X POST http://localhost:3000/api/test/load \
  -H "Content-Type: application/json" \
  -d '{"requests": 50, "delay": 20}'
```

**–û–∂–∏–¥–∞–µ–º–æ–µ –≤—Ä–µ–º—è:** 25-40 —Å–µ–∫—É–Ω–¥  
**–¶–µ–ª—å:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ –Ω–∞–≥—Ä—É–∑–∫–∏

### –¢–µ—Å—Ç 4: –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ (100 –∑–∞–ø—Ä–æ—Å–æ–≤)
```bash
curl -X POST http://localhost:3000/api/test/load \
  -H "Content-Type: application/json" \
  -d '{"requests": 100, "delay": 0}'
```

**–û–∂–∏–¥–∞–µ–º–æ–µ –≤—Ä–µ–º—è:** 50-80 —Å–µ–∫—É–Ω–¥  
**–¶–µ–ª—å:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ–ø—É—Å–∫–Ω–æ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

## –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ç–µ—Å—Ç–∞

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –ú–∞–∫—Å |
|----------|----------|--------------|------|
| `requests` | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ | 10 | 100 |
| `delay` | –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ (ms) | 100 | –ª—é–±–æ–µ |

## –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### –ü—Ä–∏–º–µ—Ä —É—Å–ø–µ—à–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞:
```json
{
  "test": {
    "totalRequests": 50,
    "successful": 50,
    "failed": 0,
    "totalTime": "32450ms",
    "avgTimePerRequest": "649ms",
    "requestsPerSecond": 1.5
  },
  "systemStats": {
    "queue": {
      "pending": 0,
      "processing": 0,
      "completed": 50,
      "failed": 0
    },
    "keyPool": {
      "totalKeys": 3,
      "healthyKeys": 3
    }
  }
}
```

### –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞:

| –ú–µ—Ç—Ä–∏–∫–∞ | –û—Ç–ª–∏—á–Ω–æ | –•–æ—Ä–æ—à–æ | –¢—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è |
|---------|---------|--------|------------------|
| Success Rate | 100% | 95-99% | < 95% |
| Avg Time/Request | < 1000ms | 1000-2000ms | > 2000ms |
| Requests/Second | > 1.5 | 1.0-1.5 | < 1.0 |
| Failed Requests | 0 | 1-5% | > 5% |

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

### –°–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏:
```bash
# –í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –≥–¥–µ –∑–∞–ø—É—â–µ–Ω npm run dev
# –í—ã —É–≤–∏–¥–∏—Ç–µ:
üîë Selected openrouter key: openrouter-0 (45/300 rpm)
üì• Queued request req_xxx (openrouter, priority 5)
‚ö° Processing request req_xxx
‚úÖ Request req_xxx completed in 3245ms
```

### –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤–æ –≤—Ä–µ–º—è —Ç–µ—Å—Ç–∞:
```bash
# –í –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
curl http://localhost:3000/api/test/load
```

## Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –ø–∞–¥–∞—é—Ç —Å –æ—à–∏–±–∫–æ–π
**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ API –∫–ª—é—á–∏ –≤ `.env.local`
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –∫–ª—é—á–∏ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ health check: `/api/system/health`

### –ü—Ä–æ–±–ª–µ–º–∞: –ù–∏–∑–∫–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å (< 0.5 req/s)
**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
1. –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ API –∫–ª—é—á–µ–π ‚Üí –î–æ–±–∞–≤—å—Ç–µ –±–æ–ª—å—à–µ –∫–ª—é—á–µ–π
2. –ú–µ–¥–ª–µ–Ω–Ω–∞—è —Å–µ—Ç—å ‚Üí –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
3. Rate limiting ‚Üí –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ warning –æ –ª–∏–º–∏—Ç–∞—Ö

### –ü—Ä–æ–±–ª–µ–º–∞: –ó–∞–ø—Ä–æ—Å—ã –∑–∞–≤–∏—Å–∞—é—Ç
**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –æ—á–µ—Ä–µ–¥—å –Ω–µ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∞ (max 1000)
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ timeout –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (default 60s)
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ dev —Å–µ—Ä–≤–µ—Ä

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –∫–ª—é—á–∞–º–∏

### –î–æ–±–∞–≤—å—Ç–µ –±–æ–ª—å—à–µ –∫–ª—é—á–µ–π –≤ `.env.local`:
```env
OPENROUTER_API_KEY=sk-or-v1-xxx
OPENROUTER_API_KEY_1=sk-or-v1-yyy
OPENROUTER_API_KEY_2=sk-or-v1-zzz
```

### –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä:
```bash
# Ctrl+C –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
npm run dev
```

### –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç —Å–Ω–æ–≤–∞:
```bash
curl -X POST http://localhost:3000/api/test/load \
  -H "Content-Type: application/json" \
  -d '{"requests": 100, "delay": 0}'
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –°–∫–æ—Ä–æ—Å—Ç—å –¥–æ–ª–∂–Ω–∞ –≤—ã—Ä–∞—Å—Ç–∏ –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –∫–ª—é—á–µ–π.

## –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

### –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:

#### Apache Bench (ab)
```bash
ab -n 100 -c 10 -p request.json -T application/json \
  http://localhost:3000/api/openrouter-chat
```

#### wrk
```bash
wrk -t12 -c100 -d30s --timeout 60s \
  http://localhost:3000/api/system/health
```

#### Artillery
```yaml
# artillery-test.yml
config:
  target: http://localhost:3000
  phases:
    - duration: 60
      arrivalRate: 10

scenarios:
  - name: Load Test
    flow:
      - post:
          url: /api/test/load
          json:
            requests: 10
            delay: 50
```

```bash
artillery run artillery-test.yml
```

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (1 –∫–ª—é—á):
- –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –¥–æ 10-20 –∑–∞–ø—Ä–æ—Å–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- –û–∂–∏–¥–∞–π—Ç–µ ~1-2 req/s

### –î–ª—è —Å—Ç–µ–π–¥–∂–∏–Ω–≥–∞ (2-3 –∫–ª—é—á–∞):
- –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –¥–æ 50 –∑–∞–ø—Ä–æ—Å–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- –û–∂–∏–¥–∞–π—Ç–µ ~3-5 req/s

### –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ (5+ –∫–ª—é—á–µ–π):
- –ú–æ–∂–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å 100+ –∑–∞–ø—Ä–æ—Å–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- –û–∂–∏–¥–∞–π—Ç–µ ~10+ req/s

## –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°–æ–∑–¥–∞–π—Ç–µ npm —Å–∫—Ä–∏–ø—Ç:
```json
{
  "scripts": {
    "test:load": "node scripts/load-test.js"
  }
}
```

### –°–∫—Ä–∏–ø—Ç `scripts/load-test.js`:
```javascript
async function runLoadTest() {
  const response = await fetch('http://localhost:3000/api/test/load', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ requests: 50, delay: 50 })
  })
  
  const result = await response.json()
  console.log('Load Test Results:', result)
  
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏
  if (result.test.failed > 0) {
    console.error('‚ùå Some requests failed!')
    process.exit(1)
  }
  
  console.log('‚úÖ All tests passed!')
}

runLoadTest()
```

## CI/CD Integration

### GitHub Actions –ø—Ä–∏–º–µ—Ä:
```yaml
name: Load Test
on: [push]

jobs:
  load-test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Setup Node
        uses: actions/setup-node@v2
      - name: Install dependencies
        run: npm install
      - name: Start server
        run: npm run dev &
      - name: Wait for server
        run: sleep 10
      - name: Run load test
        run: npm run test:load
```

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–∞–∑–æ–≤—ã–π —Ç–µ—Å—Ç (10 –∑–∞–ø—Ä–æ—Å–æ–≤)
2. ‚úÖ –î–æ–±–∞–≤—å—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ API –∫–ª—é—á–∏
3. ‚úÖ –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç —Å 50-100 –∑–∞–ø—Ä–æ—Å–∞–º–∏
4. ‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ health check endpoint
5. ‚úÖ –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

---

**–í–∞–∂–Ω–æ:** –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞—Å—Ö–æ–¥—É–µ—Ç API –∫—Ä–µ–¥–∏—Ç—ã. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–∞–∑—É–º–Ω–æ!

